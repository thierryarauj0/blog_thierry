<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blog Do Thierry Para Testes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header id="main-header">
        <div class="container">
            <h1>Blog do Thierry</h1>
            <h2>Hello World</h2>
        </div>
    </header>
    <div class="container">
        <div id="main">
            <div id="posts">
                {% for post in posts %}
                <div class="post" id="post-{{ post.id }}">
                    <h2>{{ post.title }}</h2>
                    <p>{{ post.content }}</p>
                    <p>Por: {{ post.author.username }}</p> <!-- Mostra o nome do autor -->
                    <h3>Comentários:</h3>
                    <ul id="comments-{{ post.id }}">
                        {% for comment in comments %}
                        {% if comment.post_id == post.id %}
                        <li>{{ comment.text }} - Por: {{ comment.user.username }}</li> <!-- Mostra o nome do usuário que fez o comentário -->
                        {% endif %}
                        {% endfor %}
                    </ul>
                    {% if current_user.is_authenticated %}
                    <div class="comment-form">
                        <textarea id="comment-{{ post.id }}" placeholder="Seu comentário"></textarea>
                        <button onclick="addComment({{ post.id }})">Enviar Comentário</button>
                    </div>
                    {% endif %}
                    {% if current_user.is_authenticated and current_user.admin %}
                    <div class="admin-actions">
                        <button onclick="enableEdit({{ post.id }})">Edit</button>
                        <button onclick="deletePost({{ post.id }})">Delete</button>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% if current_user.is_authenticated and current_user.admin %}
            <div id="post-form">
                <h3>Novo Post</h3>
                <input type="text" id="title" placeholder="Título do Post">
                <textarea id="content" placeholder="Conteúdo do Post"></textarea>
                <input type="submit" value="Adicionar Post" onclick="addPost()">
            </div>
            {% endif %}
        </div>
    </div>
    <footer id="main-footer">
        <div class="container">
            <p>Siga-me nas redes sociais:</p>
            <a href="https://www.facebook.com/naotenho" target="_blank">Facebook</a> |
            <a href="https://x.com/thierrysarauj" target="_blank">Twitter</a> |
            <a href="https://www.instagram.com/thierryarauj0/" target="_blank">Instagram</a> |
            <a href="https://www.linkedin.com/in/thierryarauj0/" target="_blank">LinkedIn</a>
        </div>
    </footer>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        function addComment(postId) {
            const text = document.getElementById('comment-' + postId).value;
            if (text) {
                fetch('/add_comment/' + postId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message);
                    document.getElementById('comment-' + postId).value = '';
                    const commentsList = document.getElementById('comments-' + postId);
                    const li = document.createElement('li');
                    li.appendChild(document.createTextNode(text));
                    commentsList.appendChild(li);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            }
        }
    </script>
</body>
</html>
